node('maven') {
  stage('Build App') {
    git url: "https://github.com/Mjacks3/java_x_jenkins_x_openshift_example.git"
    sh 'mvn -B -DskipTests clean package'
  }

  stage('Test App') {
   sh 'mvn test'
   junit 'target/surefire-reports/*.xml'
  }

  stage('Deploy App') {
sh 'oc new-project demod  --display-name="Demo D"'
sh 'oc create -f https://raw.githubusercontent.com/Mjacks3/java_x_jenkins_x_openshift_example/master/openshift/example.yaml'
sh 'oc start-build example-service-pipeline'
sh 'oc new-app --name=demo-app-d  wildfly~https://github.com/Mjacks3/java_x_jenkins_x_openshift_example.git'
sh 'oc rollout latest demo-app-d'
sh 'oc expose svc/demo-app-cd'
sh 'oc scale --replicas=10 dc demo-app-d'
sh 'oc scale --replicas= 2  dc demo-app-d'

  }
}